/**
 * LOPD Plugin
 * Copyright (c) 2013 Jose Mato (josemato.name)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 */
JLOPD=function(settings){var DEFAULT_CONTAINER="",DEFAULT_CALLBACK=function(loadState){},DEFAULT_SCRIPTS=[],DEFAULT_TIME2LOAD=0,BUTTON_OK="Aceptar",BUTTON_CANCEL="Cancelar",DEFAULT_COOKIE="jlopd",DEFAULT_DOMAIN=document.domain;return{init:function(conf){var conf=conf||{};this.settings={container:conf.container||DEFAULT_CONTAINER,scripts:conf.scripts||DEFAULT_SCRIPTS,callback:conf.callback||DEFAULT_CALLBACK,load:conf.load*1000||DEFAULT_TIME2LOAD,requestPermission:conf.requestPermission||false,button_ok:conf.button_ok||BUTTON_OK,button_cancel:conf.button_cancel||BUTTON_CANCEL};this.container=document.getElementById(this.settings.container);this._run()},_okClick:function(){this._hidePrivacy();this._load()},_cancelClick:function(){this._hidePrivacy();this.settings.callback(false)},_hidePrivacy:function(){this.container.style.display="none"},_addButtons:function(container){var self=this,wrapper=document.createElement("div"),buttonAccept=document.createElement("button"),buttonCancel=document.createElement("button");wrapper.setAttribute("class","privacy-police-buttons");buttonAccept.innerHTML=this.settings.button_ok;buttonCancel.innerHTML=this.settings.button_cancel;if(buttonAccept.addEventListener){buttonAccept.addEventListener("click",self._okClick.bind(self),false);buttonCancel.addEventListener("click",self._cancelClick.bind(self),false)}else{buttonAccept.attachEvent("onclick",self._load.bind(self));buttonCancel.attachEvent("onclick",self._hidePrivacy.bind(self))}wrapper.appendChild(buttonCancel);wrapper.appendChild(buttonAccept);container.appendChild(wrapper)},_load:function(){var scripts=document.createDocumentFragment(),script=document.createElement("script"),s=this.settings.scripts,t=s.length,i=-1,load=this.settings.load*1000;while(++i<t){script.src=s[i];scripts.appendChild(script)}document.getElementsByTagName("body")[0].appendChild(scripts);this.settings.callback(true)},_run:function(){var s=this.settings;if(this._isFirstVisit()){this._addVisit();if(!this.container){return}if(s.requestPermission){this._addButtons(this.container);s.load=0}this.container.style.display="block";if(s.load>0){setTimeout(this._load.bind(this),s.load)}else{if(!s.requestPermission){this.settings.callback(true)}}}else{console.log("LOAD NOW");this._load()}},_isFirstVisit:function(){var isNewUser=document.referrer.indexOf(document.domain)==-1;if(isNewUser){if(localStorage){return localStorage.getItem(DEFAULT_COOKIE)==null}}return isNewUser},_addVisit:function(){if(localStorage){localStorage.setItem(DEFAULT_COOKIE,1)}}}}();